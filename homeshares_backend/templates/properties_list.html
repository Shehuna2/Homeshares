{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-12 space-y-10">

  <!-- Page Header -->
  <h1 class="text-4xl font-extrabold text-center text-gray-900">
    üè° Explore <span class="text-green-600">Available Properties</span>
  </h1>
  <p class="text-center text-gray-500 max-w-2xl mx-auto">Invest in vetted real estate assets and earn ETH-backed returns</p>

  <!-- Property Grid -->
  <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
    {% for prop in properties %}
    <div class="bg-white rounded-2xl shadow-xl hover:shadow-2xl transition-all border border-gray-100 p-6 flex flex-col justify-between group property-card"
         data-address="{{ prop.crowdfund_address }}"
         data-abi='{{ cf_abi_json|safe }}'>

      <!-- Property Header -->
      <div>
        <h2 class="text-2xl font-bold text-gray-800 group-hover:text-green-600 transition">
          {{ prop.name }} <span class="text-sm text-gray-400 font-normal">({{ prop.symbol }})</span>
        </h2>

        <!-- Goal & Raised -->
        <div class="mt-4 space-y-1 text-sm text-gray-700">
          <p><strong>Goal:</strong> <span class="goal text-green-700 font-semibold">{{ prop.goal|floatformat:2 }}</span> $MON <span class="goal-usd text-xs text-gray-400">$0.00</span></p>
          <p><strong>Raised:</strong> <span class="raised text-blue-700 font-semibold">{{ prop.raised|default:"0"|floatformat:2 }}</span> / {{ prop.goal|floatformat:2 }} $MON <span class="raised-usd text-xs text-gray-400">$0.00</span></p>
        </div>

        <!-- Progress Bar -->
        {% with progress=prop.raised|default:0 %}
        {% widthratio progress prop.goal 100 as percent %}
        <div class="mt-4 relative">
          <div class="w-full bg-gray-200 h-3 rounded-full overflow-hidden">
            <div class="h-full bg-gradient-to-r from-green-400 to-green-600 rounded-full transition-all duration-500" style="width: {{ percent }}%"></div>
          </div>
          <span class="absolute -top-5 right-0 text-xs text-gray-500 font-medium">{{ percent|floatformat:0 }}% Funded</span>
        </div>
        {% endwith %}
      </div>

      <!-- Contribution Form -->
      <div class="mt-6 space-y-3">
        <label class="block text-sm font-medium text-gray-700">Your Contribution</label>
        <input type="number" min="0.01" step="0.01"
               placeholder="e.g. 0.25 $MON"
               class="input-amount w-full border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-green-500"
               id="amount-{{ forloop.counter }}" />

        <button
          class="btn-contribute flex items-center justify-center bg-green-600 text-white py-2 rounded-lg font-semibold hover:bg-green-700 transition-all disabled:opacity-50 w-full"
          data-address="{{ prop.crowdfund_address }}"
          data-abi='{{ cf_abi_json|safe }}'
          data-input-id="amount-{{ forloop.counter }}"
          data-goal="{{ prop.goal }}"
          data-raised="{{ prop.raised|default:'0' }}"
        >
          <!-- spinner -->
          <svg class="spinner hidden animate-spin h-5 w-5 mr-2 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor"
                  d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
          </svg>
          <span class="label">üí∏ Contribute</span>
        </button>
      </div>

    </div>
    {% empty %}
    <p class="text-center text-gray-500 col-span-full text-lg py-12">No properties available yet. Please check back soon.</p>
    {% endfor %}
  </div>
</div>
{% endblock %}

{% block scripts %}
  {{ block.super }}
{% endblock %}
